# Пользовательский WebGPU-движок

Этот проект — это исследование **унифицированного API для 3D-взаимодействий** на базе WebGPU. В отличие от традиционных движков, таких как `three.js`, которые предоставляют отдельные компоненты для камеры (`PerspectiveCamera`) и управления (`OrbitControls`), мы стремимся к созданию единой точки входа для управления сценой от первого лица.

Ключевая идея заключается в классе `ViewPoint`. Он абстрагирует способ взаимодействия, позволяя использовать единый API для управления камерой на самых разных платформах:

* **Десктоп** (мышь и клавиатура)
* **Мобильные устройства** (тач-события)
* **VR/AR-гарнитуры** (в перспективе)

Такой подход, ориентированный на вид от первого лица, избавляет от необходимости вручную настраивать и связывать множество контроллеров, что является основной причиной существования этого проекта. Мы исследуем, насколько эргономичным может быть движок, если он изначально спроектирован под современные, мультиплатформенные задачи.

## Установка и запуск

1. Установите зависимости:

    ```bash
    bun install
    ```

2. Запустите проект:

    ```bash
    bun run dev
    ```

После запуска в вашем браузере откроется страница с примером рендеринга.

## Управление в примерах

Интерактивное взаимодействие обеспечивается классом `ViewPoint`, который объединяет камеру и орбитальное управление. Логика адаптирована для разных устройств ввода.

### Мышь

| Действие | Ввод пользователя |
| :--- | :--- |
| **Вращение** | Зажать **левую кнопку** и двигать |
| **Панорамирование**| Зажать **правую кнопку** и двигать |
| **Панорамирование (X/Y)** | Прокрутка **колесиком** |
| **Масштаб** | **`Ctrl` + Прокрутка колесиком** |

### Тачпад (Ноутбук)

| Действие | Ввод пользователя |
| :--- | :--- |
| **Вращение** | Двигать **одним пальцем** (с нажатием) |
| **Панорамирование**| Смахивать **двумя пальцами** |
| **Масштаб** | Жест **"щипок"** (Pinch-to-Zoom) |

### Тачскрин (Смартфон/Планшет)

| Действие | Ввод пользователя |
| :--- | :--- |
| **Вращение** | Двигать **одним пальцем** |
| **Панорамирование и Масштаб**| Двигать **двумя пальцами** (щипок и перетаскивание) |

## Структура проекта

* `examples/`: Содержит примеры использования движка.
* `src/`: Исходный код движка.
  * `core/`: Основные классы, такие как `Object3D`, `Mesh` и `ViewPoint`.
  * `geometries/`: Геометрические формы (`TorusGeometry`).
  * `helpers/`: Вспомогательные объекты для отладки (`GridHelper`).
  * `lights/`: Источники света (`Light`, `DirectionalLight`).
  * `loaders/`: Загрузчики моделей (`GLTFLoader`).
  * `materials/`: Материалы, определяющие внешний вид объектов.
  * `math/`: Математические утилиты для работы с векторами, матрицами и цветом.
  * `objects/`: Базовые объекты для рисования, такие как линии (`Line`, `LineSegments`).
  * `renderers/`: Рендерер, отвечающий за отрисовку сцены (`WebGPURenderer`).
  * `scenes/`: Класс для управления сценой (`Scene`).
  * `WebGPUEngine.ts`: Главный файл, экспортирующий все компоненты движка.

## Архитектурное решение: Система координат

В движке используется **правосторонняя** система координат (Right-Handed, RH) с осью **Y, направленной вверх**, и камерой, смотрящей вдоль своей локальной оси **-Z**. Диапазон глубины (clip space) находится в промежутке **[0, 1]**.

### Обоснование выбора

Этот выбор не случаен — он полностью соответствует стандарту, принятому в **WebGPU**. Такой подход обеспечивает максимальную нативность при работе с API и избавляет от необходимости выполнять лишние преобразования матриц, которые потребовались бы при использовании других конвенций (например, из мира OpenGL/WebGL).

Многие разработчики приходят из экосистемы Blender (где Z направлена вверх) или WebGL (где диапазон глубины от -1 до 1). Важно понимать эти различия, чтобы избежать путаницы при работе с матрицами и трансформациями. Наш движок осознанно придерживается конвенции WebGPU для чистоты и производительности.

### Сравнительная таблица систем координат

| Система | Ориентация осей в мире | Направление камеры | "Рука" | Диапазон глубины (Z) |
| :--- | :--- | :--- | :--- | :--- |
| **Наш движок (WebGPU)** | X вправо, Y вверх, Z "из экрана" | Вдоль -Z | Правая (RH) | `0` до `1` |
| **WebGL** | X вправо, Y вверх, Z "из экрана" | Вдоль -Z | Правая (RH) | `-1` до `1` |
| **Blender** | X вправо, Y вперед, Z вверх | Вдоль -Z | Правая (RH) | Зависит от рендера (`0..1` или `-1..1`) |
| **Babylon.js (по умолч.)**| X вправо, Y вверх, Z вперед | Вдоль +Z | Левая (LH) | `0` до `1` |

## Ключевые отличия от `three.js`

| Функция | Наш движок | Three.js |
| :--- | :--- | :--- |
| **Архитектура Камеры** | Единый класс `ViewPoint` объединяет камеру и управление для простоты API. | Раздельные классы `Camera` и `OrbitControls`, требующие ручной связки. |
| **API Рендеринга** | Исключительно **WebGPU**. | В основном **WebGL 1/2**, с поддержкой WebGPU. |
| **Система координат** | **RH_ZO**: Правосторонняя, Y-вверх, глубина [0, 1] (стандарт WebGPU). | **LH_YO**: Левосторонняя, Y-вверх, глубина [-1, 1] (стандарт OpenGL). |
| **Геометрии** | Только `TorusGeometry`. | Десятки встроенных геометрий (кубы, сферы, плоскости и т.д.). |
| **Материалы** | `MeshBasicMaterial`, `LineBasicMaterial` и `MeshLambertMaterial` (диффузное освещение). | Множество материалов с поддержкой PBR, текстур и сложных шейдеров. |
| **Вспомогательные объекты**| `GridHelper` для визуализации координатной сетки. | Большой набор хелперов для отладки (камеры, скелеты, нормали и т.д.). |
| **Загрузчики** | Поддержка `glTF`. | Поддержка загрузки 3D-моделей в форматах, таких как glTF, OBJ, FBX и др. |
| **Экосистема** | Минимальная, проект на начальной стадии. | Огромное сообщество, обширная документация, множество плагинов и примеров. |
