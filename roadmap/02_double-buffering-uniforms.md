# –ü–æ–¥–∑–∞–¥–∞—á–∞: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–π –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ Uniform-–¥–∞–Ω–Ω—ã—Ö

## üìå –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
*   `src/renderer/index.ts` (–æ—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

## üõ† –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–≤–æ–π–Ω—É—é –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö uniform-–¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ 01 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ CPU –∏ GPU –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É.

### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
1.  –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `FRAMES_IN_FLIGHT = 2` (–¥–ª—è –¥–≤–æ–π–Ω–æ–π –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏).
2.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `MAX_RENDERABLES` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –æ–¥–Ω–æ–π "—Å–µ–∫—Ü–∏–∏ –∫–∞–¥—Ä–∞".

### –®–∞–≥ 2: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±—É—Ñ–µ—Ä(—ã)
1.  –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä `perObjectUniformBuffer` (–∏–ª–∏ `unifiedUniformBuffer`) –≤ `FRAMES_IN_FLIGHT` —Ä–∞–∑.
2.  –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä CPU-–º–∞—Å—Å–∏–≤–∞ `perObjectDataCPU`.

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–¥—Ä–∞–º–∏
1.  –í –∫–ª–∞—Å—Å `Renderer` –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –ø–æ–ª–µ `currentFrameIndex = 0`.
2.  –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `getFrameOffset(): number`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–∞–¥—Ä–∞:
    ```typescript
    private getFrameOffset(): number {
        const frame = this.currentFrameIndex % FRAMES_IN_FLIGHT;
        return frame * MAX_RENDERABLES * PER_OBJECT_DATA_SIZE;
    }
    ```

### –®–∞–≥ 4: –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ü–∏–∫–ª —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
1.  –í –Ω–∞—á–∞–ª–µ `render()` –≤—ã—á–∏—Å–ª–∏—Ç—å `baseOffset = this.getFrameOffset()`.
2.  –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ `perObjectDataCPU` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–º–µ—â–µ–Ω–∏–µ: `baseOffset + objectIndex * PER_OBJECT_DATA_SIZE`.
3.  –í –≤—ã–∑–æ–≤–µ `writeBuffer` —É–∫–∞–∑–∞—Ç—å `baseOffset` –∫–∞–∫ target offset.
4.  –í `setBindGroup` –¥–ª—è per-object –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –∫–∞–∫ `baseOffset + objectOffset`.
5.  **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä-–ø–∞—Å—Å–∞ (–ø–æ—Å–ª–µ `submit`) –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `currentFrameIndex`.**

### –®–∞–≥ 5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–±–µ–¥–∏—Ç—å—Å—è
1.  –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, –ø–æ–∫–∞ GPU –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç.
2.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ –≤—ã—Å–æ–∫–∏—Ö FPS ‚Äî –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "—Ä–∞–∑—Ä—ã–≤–∞—é—â–∏—Ö—Å—è" –æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
*   CPU –∏ GPU —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –±–µ–∑ –≤–∑–∞–∏–º–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
*   –ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –Ω–∞ –≤—ã—Å–æ–∫–∏—Ö —á–∞—Å—Ç–æ—Ç–∞—Ö –∫–∞–¥—Ä–æ–≤ (>60 FPS) –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –≥–æ–Ω–∫–æ–π –¥–∞–Ω–Ω—ã—Ö.
*   –í –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–µ –≤–∏–¥–Ω–æ, —á—Ç–æ CPU –Ω–µ –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–∞–¥—Ä–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö —Å–ª–µ–¥—É—é—â–µ–≥–æ.